<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Breath Coach — Mobile</title>
  <style>
    :root{
      --bg:#0b1220; --fg:#eef2f7; --muted:#9aa4b2; --line:#243248; --accent:#22c55e;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(900px 600px at 100% -10%, #142039 0%, #0b1220 60%);
      color:var(--fg); font-family: ui-sans-serif, -apple-system, system-ui, "Segoe UI", Inter, Roboto, Arial;
      display:flex; flex-direction:column; gap:16px;
    }
    header{padding:12px 16px 0; text-align:center}
    h1{margin:0; font-size:18px; font-weight:600; letter-spacing:.2px}
    main{flex:1; display:grid; place-items:center; padding:0 12px 24px}
    .card{
      width:min(540px, 100%);
      background:rgba(255,255,255,.02);
      border:1px solid var(--line);
      border-radius:18px;
      padding:20px;
      display:grid; gap:16px;
    }
    .stage{
      width:100%; display:grid; place-items:center; gap:8px;
    }
    .bubble{
      width:min(80vmin, 360px); aspect-ratio:1;
      border-radius:50%;
      background: radial-gradient(circle at 50% 38%, rgba(34,197,94,.35), rgba(34,197,94,.15));
      box-shadow: inset 0 0 40px rgba(34,197,94,.2), 0 10px 40px rgba(0,0,0,.35);
      transition: transform .6s ease;
      will-change: transform;
    }
    .label{font-size:18px; letter-spacing:.4px}
    .timer{font-size:14px; color:var(--muted)}
    .row{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
    select, button, .toggle{
      font-size:16px; padding:14px 16px; border-radius:14px;
      border:1px solid var(--line); background:#0a1528; color:var(--fg);
    }
    select{min-width:180px}
    button{min-width:180px}
    button.primary{background:linear-gradient(180deg, #22c55e, #16a34a); border:none; color:white; font-weight:700}
    button.secondary{background:transparent; color:var(--muted)}
    footer{padding:8px 12px 16px; text-align:center; color:var(--muted); font-size:12px}
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <header><h1>Breath Coach</h1></header>
  <main>
    <section class="card" aria-live="polite">
      <div class="stage">
        <div class="bubble" id="bubble"></div>
        <div class="label" id="phase">Ready</div>
        <div class="timer" id="stats">00:00 • 0 breaths</div>
      </div>
      <div class="row">
        <label for="pattern" class="sr-only">Pattern</label>
        <select id="pattern" aria-label="Pattern">
          <option value="4-4-4-4">Box 4•4•4•4</option>
          <option value="4-7-8">4•7•8</option>
          <option value="5-5-5-5">Coherent 5•5•5•5</option>
          <option value="6-0-6-0">Simple 6•6</option>
        </select>
        <button id="start" class="primary">Start</button>
        <button id="reset" class="secondary">Reset</button>
      </div>
      <div class="small">Tip: Add to Home Screen for a one-tap, offline app.</div>
    </section>
  </main>
  <footer>Designed for iPhone & Android • No tracking</footer>

  <script>
    // Minimal, iPhone-friendly timing using setInterval (avoids rAF quirks in iOS)
    const bubble = document.getElementById('bubble');
    const phaseEl = document.getElementById('phase');
    const statsEl = document.getElementById('stats');
    const startBtn = document.getElementById('start');
    const resetBtn = document.getElementById('reset');
    const patternSel = document.getElementById('pattern');

    let schedule = [];
    let idx = -1;
    let left = 0;
    let timer = null;
    let running = false;
    let startedAt = 0;
    let elapsed = 0;
    let breaths = 0;

    function fmt(ms){
      const s = Math.floor(ms/1000);
      return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');
    }

    function build(){
      const parts = patternSel.value.split('-').map(x=>parseInt(x,10));
      const [inn,h1,out,h2] = parts;
      schedule = [];
      if(inn>0) schedule.push(['Inhale', inn]);
      if(h1>0) schedule.push(['Hold', h1]);
      if(out>0) schedule.push(['Exhale', out]);
      if(h2>0) schedule.push(['Hold', h2]);
      if(schedule.length===0) schedule = [['Inhale',4],['Exhale',4]];
    }

    function setPhase(name){
      phaseEl.textContent = name;
      // Keep animation gentle for motion sensitivity
      if(name==='Inhale') bubble.style.transform = 'scale(1.6)';
      else if(name==='Exhale') bubble.style.transform = 'scale(0.7)';
      else bubble.style.transform = 'scale(1)';
      // Light haptic on phase change where supported
      if(navigator.vibrate) navigator.vibrate(30);
    }

    function tick(){
      const now = Date.now();
      elapsed = now - startedAt;
      left -= 0.1; // seconds
      if(left <= 0){
        idx = (idx + 1) % schedule.length;
        const [name, secs] = schedule[idx];
        left = secs;
        if(name==='Inhale') breaths += 1;
        setPhase(name);
      }
      statsEl.textContent = fmt(elapsed) + ' • ' + breaths + (breaths===1 ? ' breath' : ' breaths');
    }

    function start(){
      if(running) return;
      build();
      idx = -1; left = 0; breaths = 0;
      startedAt = Date.now(); elapsed = 0;
      setPhase('Ready');
      running = true;
      startBtn.textContent = 'Pause';
      timer = setInterval(tick, 100);
    }

    function pause(){
      if(!running) return;
      running = false;
      startBtn.textContent = 'Start';
      clearInterval(timer); timer = null;
    }

    function reset(){
      pause();
      idx = -1; left = 0; breaths = 0; elapsed = 0;
      bubble.style.transform = 'scale(1)';
      phaseEl.textContent = 'Ready';
      statsEl.textContent = '00:00 • 0 breaths';
    }

    startBtn.addEventListener('click', ()=>{
      if(!running) start(); else pause();
    });
    resetBtn.addEventListener('click', reset);
    patternSel.addEventListener('change', ()=>{ if(!running) build(); });

    // init
    build();
  </script>
</body>
</html>
